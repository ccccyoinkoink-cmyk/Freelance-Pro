<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freelance Pro Timer V3 â³</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #334155;
            --subtext: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --money: #059669;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container { width: 100%; max-width: 650px; padding-bottom: 60px; }

        /* é¡¶éƒ¨å¯¼èˆª */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        h1 { font-size: 1.5rem; margin: 0; }
        
        .btn {
            padding: 8px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 500; transition: opacity 0.2s; font-size: 0.9rem; font-family: inherit;
        }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-outline { background-color: transparent; border: 1px solid var(--border); color: var(--subtext); }
        .btn-sm { padding: 4px 10px; font-size: 0.8rem; }
        .btn-danger { background-color: #fee2e2; color: var(--danger); }
        .btn-text-danger { background: none; border: none; color: var(--subtext); padding: 2px 6px; cursor: pointer;}
        .btn-text-danger:hover { color: var(--danger); background: #fee2e2; border-radius: 4px; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tab { padding: 6px 12px; border-radius: 20px; cursor: pointer; color: var(--subtext); background: transparent; }
        .tab.active { background-color: var(--text); color: white; font-weight: bold; }

        /* é¡¹ç›®å¡ç‰‡ */
        .project-card {
            background: var(--card-bg); border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border);
        }
        
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .project-title-group { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .project-title { font-size: 1.2rem; font-weight: 700; margin: 0; }
        .project-tag { font-size: 0.75rem; padding: 2px 8px; border-radius: 12px; background: #e0f2fe; color: #0369a1; font-weight: 500; }
        .project-meta { font-size: 0.9rem; color: var(--subtext); display: flex; gap: 15px; margin-bottom: 16px; }
        .meta-item { display: flex; align-items: center; gap: 4px; }

        /* è¿›åº¦æ¡ */
        .progress-section { margin: 15px 0; display: flex; flex-direction: column; gap: 10px; }
        .progress-row { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; color: var(--subtext); }
        .progress-label { width: 70px; text-align: right; flex-shrink: 0; }
        .progress-bar-bg { flex-grow: 1; height: 8px; background: #f1f5f9; border-radius: 4px; overflow: hidden; position: relative;}
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; border-radius: 4px;}
        .progress-text { width: 50px; flex-shrink: 0; text-align: right;}
        
        .fill-warning { background: var(--warning); }
        .fill-danger { background: var(--danger); }
        .fill-money { background: var(--money); }
        .fill-success { background: var(--success); }

        /* æ“ä½œåŒº */
        .actions { display: flex; align-items: center; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f1f5f9; }
        .timer-display { font-size: 1.3rem; font-weight: 700; color: var(--text); margin-right: 12px; font-variant-numeric: tabular-nums; }
        .controls { display: flex; gap: 8px; align-items: center; }

        /* æ¯æ—¥è®°å½• */
        .daily-logs { margin-top: 15px; padding-top: 10px; border-top: 1px dashed var(--border); font-size: 0.85rem; color: var(--subtext); }
        .daily-logs-title { font-weight: 600; margin-bottom: 8px; display: block; }
        .log-list { max-height: 120px; overflow-y: auto; }
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; border-bottom: 1px solid #f8fafc; }

        /* å¼¹çª— */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal { background: white; padding: 24px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.9rem; font-weight: 500; color: var(--text); }
        .form-control { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .form-control[readonly] { background-color: #f1f5f9; cursor: not-allowed; }
        .form-row { display: flex; gap: 12px; } .form-row .form-group { flex: 1; }

        .empty-state { text-align: center; color: var(--subtext); padding: 50px 20px; }
        
        /* åº•éƒ¨é‡ç½® */
        .footer-reset {
            margin-top: 40px; text-align: center; font-size: 0.8rem; color: #cbd5e1;
        }
        .btn-reset { background: none; border: none; color: #cbd5e1; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>â³ Freelance Pro</h1>
        <button class="btn btn-primary" onclick="openCreateModal()">ï¼‹ æ–°å»ºé¡¹ç›®</button>
    </header>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('active')" id="tab-active">âš¡ è¿›è¡Œä¸­</div>
        <div class="tab" onclick="switchTab('archived')" id="tab-archived">ğŸ“¦ å·²ç»“é¡¹</div>
    </div>

    <div id="project-list"></div>
    
    <div class="footer-reset">
        é‡åˆ°é—®é¢˜ï¼Ÿ<button class="btn-reset" onclick="hardReset()">ç‚¹å‡»æ¸…é™¤æ‰€æœ‰æ•°æ®å¹¶é‡ç½®</button>
    </div>
</div>

<div id="modal-create" class="modal-overlay">
    <div class="modal">
        <h3>âœ¨ æ–°å»ºå•†ä¸šé¡¹ç›®</h3>
        <div class="form-group">
            <label>é¡¹ç›®åç§°</label>
            <input type="text" id="new-name" class="form-control" placeholder="ä¾‹å¦‚ï¼šæŸæŸå“ç‰ŒVIå‡çº§">
        </div>
        <div class="form-group">
            <label>é¡¹ç›®åˆ†ç±»æ ‡ç­¾ (å¯é€‰)</label>
            <input type="text" id="new-project-tag" class="form-control" placeholder="ä¾‹å¦‚ï¼šé•¿æœŸå®¢æˆ· / å¤–åŒ…">
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>æ€»é¢„ç®—é‡‘é¢ (Â¥)</label>
                <input type="number" id="new-budget-money" class="form-control" placeholder="10000" min="0">
            </div>
            <div class="form-group">
                <label>é¢„ä¼°æ€»å·¥æ—¶ (h)</label>
                <input type="number" id="new-budget-hours" class="form-control" placeholder="50" min="0.1">
            </div>
        </div>
        <div class="form-group">
            <label>æŠ˜ç®—æ—¶è–ª (Â¥/h, è‡ªåŠ¨è®¡ç®—)</label>
            <input type="text" id="calc-rate" class="form-control" readonly placeholder="...">
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-outline" onclick="closeModal('create')">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="createProject()">åˆ›å»º</button>
        </div>
    </div>
</div>

<div id="modal-log" class="modal-overlay">
    <div class="modal">
        <h3>ğŸ“ æ‰‹åŠ¨è¡¥å¡</h3>
        <input type="hidden" id="log-project-id">
        <div class="form-group">
            <label>æ—¥æœŸ</label>
            <input type="date" id="log-date" class="form-control">
        </div>
        <div class="form-group">
            <label>æ—¶é•¿ (åˆ†é’Ÿ)</label>
            <input type="number" id="log-duration" class="form-control" placeholder="ä¾‹å¦‚: 60 æˆ– -30">
            <small style="color: var(--subtext)">è¾“å…¥è´Ÿæ•°å¯æ‰£å‡æ—¶é—´</small>
        </div>
        <div class="form-group">
            <label>å·¥ä½œå†…å®¹æ ‡ç­¾ (é€‰å¡«)</label>
            <input type="text" id="log-work-tag" class="form-control" placeholder="#ä¼šè®® #ä¿®æ”¹">
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-outline" onclick="closeModal('log')">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="saveManualLog()">ä¿å­˜è®°å½•</button>
        </div>
    </div>
</div>

<script>
    // å®šä¹‰ Keyï¼Œæ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†
    const DB_KEY = 'freelancer_projects_v2';
    
    // å…¨å±€å˜é‡
    let projects = [];
    let currentTab = 'active';
    let timerInterval = null;

    // --- åˆå§‹åŒ–ä¸å®‰å…¨åŠ è½½ ---
    window.addEventListener('DOMContentLoaded', () => {
        try {
            loadAndRepairData();
            initModalListeners();
            renderProjects();
            startGlobalTicker();
        } catch (e) {
            console.error("Critical Init Error:", e);
            alert("åŠ è½½æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·å°è¯•ç‚¹å‡»é¡µé¢åº•éƒ¨çš„é‡ç½®æŒ‰é’®ã€‚");
        }
    });

    // ğŸ›¡ï¸ æ•°æ®åŠ è½½ä¸è‡ªæˆ‘ä¿®å¤ (å…³é”®ä¿®å¤ç‚¹)
    function loadAndRepairData() {
        const raw = localStorage.getItem(DB_KEY);
        if (!raw) {
            projects = [];
            return;
        }

        try {
            let data = JSON.parse(raw);
            if (!Array.isArray(data)) data = [];

            // éå†å¹¶ä¿®å¤æ—§æ•°æ®ç»“æ„
            projects = data.map(p => {
                // ç¡®ä¿ logs æ•°ç»„å­˜åœ¨
                if (!Array.isArray(p.logs)) {
                    p.logs = [];
                    // å¦‚æœæ—§æ•°æ®æœ‰ totalSecondsï¼Œè½¬æ¢æˆä¸€æ¡åˆå§‹ log
                    if (p.totalSeconds && p.totalSeconds > 0) {
                        p.logs.push({
                            id: Date.now(),
                            dateStr: new Date().toISOString().split('T')[0],
                            durationSeconds: p.totalSeconds,
                            workTag: 'åˆå§‹å¯¼å…¥',
                            type: 'manual'
                        });
                    }
                }
                // ç¡®ä¿ budgetMoney å’Œ budgetHours å­˜åœ¨
                if (!p.budgetMoney) p.budgetMoney = p.budget || 0;
                if (!p.budgetHours) p.budgetHours = p.budget || 1; // é¿å…é™¤ä»¥0
                
                // é‡æ–°è®¡ç®—æ—¶è–ª
                if (!p.calculatedRate) {
                    p.calculatedRate = p.budgetMoney / (p.budgetHours || 1);
                }
                
                return p;
            });
        } catch (e) {
            console.error("Data parse error", e);
            projects = [];
        }
    }

    // --- æ¸²æŸ“é€»è¾‘ ---
    function switchTab(tab) {
        currentTab = tab;
        document.getElementById('tab-active').classList.toggle('active', tab === 'active');
        document.getElementById('tab-archived').classList.toggle('active', tab === 'archived');
        renderProjects();
    }

    function renderProjects() {
        const container = document.getElementById('project-list');
        if (!container) return;
        
        container.innerHTML = '';
        const filtered = projects.filter(p => currentTab === 'active' ? p.status !== 'archived' : p.status === 'archived');

        if (filtered.length === 0) {
            container.innerHTML = `<div class="empty-state">${currentTab === 'active' ? 'æ²¡æœ‰è¿›è¡Œä¸­çš„é¡¹ç›®ï¼Œå¿«å»æé’±ï¼ğŸ’¸' : 'è¿˜æ²¡æœ‰å½’æ¡£çš„é¡¹ç›® ğŸ“­'}</div>`;
            return;
        }

        filtered.forEach(p => {
            // å®‰å…¨è®¡ç®—
            const totalSeconds = p.logs.reduce((sum, log) => sum + (log.durationSeconds || 0), 0);
            const totalHoursUsed = totalSeconds / 3600;
            const rate = p.calculatedRate || 0;
            const totalMoneyEarned = totalHoursUsed * rate;
            
            let timePercent = p.budgetHours > 0 ? (totalHoursUsed / p.budgetHours) * 100 : 0;
            let moneyPercent = p.budgetMoney > 0 ? (totalMoneyEarned / p.budgetMoney) * 100 : 0;

            // é¢œè‰²é€»è¾‘
            let timeColorClass = '';
            if (timePercent >= 100) timeColorClass = 'fill-danger';
            else if (timePercent >= 80) timeColorClass = 'fill-warning';
            
            let moneyColorClass = 'fill-money';
            if (moneyPercent >= 100 && timePercent < 100) moneyColorClass = 'fill-success';

            // è®¡æ—¶çŠ¶æ€
            let currentSessionSeconds = 0;
            if (p.isRunning && p.currentSessionStart) {
                currentSessionSeconds = (Date.now() - p.currentSessionStart) / 1000;
            }
            const displaySeconds = totalSeconds + currentSessionSeconds;
            const btnClass = p.isRunning ? 'btn-danger' : 'btn-primary';
            const btnText = p.isRunning ? 'â¹ï¸ åœæ­¢' : 'â–¶ï¸ å¼€å§‹';
            const btnAction = p.isRunning ? `stopTimer(${p.id})` : `startTimer(${p.id})`;

            // æ—¥å¿—æ¸²æŸ“
            let logsHtml = '';
            if (p.logs.length > 0) {
                const sortedLogs = [...p.logs].sort((a, b) => b.id - a.id);
                logsHtml = sortedLogs.map(log => {
                    const durationMin = Math.round(log.durationSeconds / 60);
                    const tagStr = log.workTag ? `<span style="color:var(--primary); margin-left:5px;">${log.workTag}</span>` : '';
                    return `
                        <div class="log-item">
                            <div class="log-info">
                                <span>${log.dateStr || '-'}</span>
                                <span style="margin-left:10px"><b>${durationMin > 0 ? '+' : ''}${durationMin}m</b> ${tagStr}</span>
                            </div>
                            <button class="btn-text-danger" onclick="deleteLog(${p.id}, ${log.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    `;
                }).join('');
            }

            const html = `
                <div class="project-card">
                    <div class="card-header">
                        <div class="header-top">
                            <div class="project-title-group">
                                <h3 class="project-title">${p.name}</h3>
                                ${p.projectTag ? `<span class="project-tag">${p.projectTag}</span>` : ''}
                            </div>
                            <div class="badge" style="font-weight:600">Â¥${rate.toFixed(0)}/h</div>
                        </div>
                        <div class="project-meta">
                            <div class="meta-item">ğŸ’° é¢„ç®— Â¥${(p.budgetMoney||0).toLocaleString()}</div>
                            <div class="meta-item">â±ï¸ å·¥æ—¶ ${p.budgetHours}h</div>
                            <div class="meta-item" style="color: var(--money); font-weight:600">ğŸ’µ å·²äº§å‡º: Â¥${totalMoneyEarned.toLocaleString(undefined, {maximumFractionDigits: 0})}</div>
                        </div>
                    </div>

                    <div class="progress-section">
                        <div class="progress-row">
                            <span class="progress-label">å·¥æ—¶è¿›åº¦</span>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill ${timeColorClass}" style="width: ${Math.min(timePercent, 100)}%"></div>
                            </div>
                            <span class="progress-text">${timePercent.toFixed(0)}%</span>
                        </div>
                        <div class="progress-row">
                            <span class="progress-label">é¢„ç®—æ¶ˆè€—</span>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill ${moneyColorClass}" style="width: ${Math.min(moneyPercent, 100)}%"></div>
                            </div>
                            <span class="progress-text">${moneyPercent.toFixed(0)}%</span>
                        </div>
                    </div>

                    <div class="actions">
                        <div class="controls">
                            <button class="btn ${btnClass}" onclick="${btnAction}">${btnText}</button>
                            <span class="timer-display" id="timer-${p.id}">${formatTimeHHMM(displaySeconds)}</span>
                        </div>
                        <div class="controls">
                             ${currentTab === 'active' ? 
                                `<button class="btn btn-outline btn-sm" onclick="openLogModal(${p.id})">âœï¸ è¡¥å¡</button>
                                 <button class="btn btn-outline btn-sm" onclick="toggleArchive(${p.id}, 'archived')">ğŸ“¦ ç»“é¡¹</button>` 
                                : 
                                `<button class="btn btn-outline btn-sm" onclick="toggleArchive(${p.id}, 'active')">ğŸ”„ æ¿€æ´»</button>
                                 <button class="btn btn-danger btn-sm" onclick="deleteProject(${p.id})">ğŸ—‘ï¸ åˆ é™¤</button>`
                            }
                        </div>
                    </div>
                    ${p.logs.length > 0 ? `<div class="daily-logs"><span class="daily-logs-title">ğŸ“… æ¯æ—¥è®°å½•</span><div class="log-list">${logsHtml}</div></div>` : ''}
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    }

    // --- æ ¸å¿ƒæ“ä½œ ---
    function startTimer(id) {
        projects.forEach(p => { if(p.isRunning) stopTimer(p.id); });
        const p = projects.find(p => p.id === id);
        if(p) {
            p.isRunning = true;
            p.currentSessionStart = Date.now();
            saveAndRender();
        }
    }

    function stopTimer(id) {
        const p = projects.find(p => p.id === id);
        if (p && p.isRunning) {
            const durationSeconds = (Date.now() - p.currentSessionStart) / 1000;
            if (durationSeconds > 5) { // å¿½ç•¥5ç§’å†…çš„è¯¯è§¦
                addLogEntry(p, durationSeconds, 'timer');
            }
            p.isRunning = false;
            p.currentSessionStart = null;
            saveAndRender();
        }
    }

    function createProject() {
        const name = document.getElementById('new-name').value;
        const projectTag = document.getElementById('new-project-tag').value;
        const budgetMoney = parseFloat(document.getElementById('new-budget-money').value) || 0;
        const budgetHours = parseFloat(document.getElementById('new-budget-hours').value) || 0;

        if (!name || budgetMoney <= 0 || budgetHours <= 0) return alert('è¯·å¡«å†™å®Œæ•´çš„é¡¹ç›®ä¿¡æ¯ï¼ˆåç§°ã€é‡‘é¢ã€å·¥æ—¶ï¼‰');

        projects.unshift({
            id: Date.now(),
            name,
            projectTag,
            budgetMoney,
            budgetHours,
            calculatedRate: budgetMoney / budgetHours,
            status: 'active',
            logs: [],
            isRunning: false
        });
        
        closeModal('create');
        saveAndRender();
    }

    function saveManualLog() {
        const id = parseInt(document.getElementById('log-project-id').value);
        const durationMin = parseFloat(document.getElementById('log-duration').value) || 0;
        const dateStr = document.getElementById('log-date').value;
        const workTag = document.getElementById('log-work-tag').value;

        if (durationMin === 0) return alert('æ—¶é•¿ä¸èƒ½ä¸º0');
        if (!dateStr) return alert('è¯·é€‰æ‹©æ—¥æœŸ');

        const p = projects.find(p => p.id === id);
        if (p) {
            addLogEntry(p, durationMin * 60, 'manual', dateStr, workTag);
            saveAndRender();
        }
        closeModal('log');
    }

    function deleteLog(pid, logId) {
        if(confirm('åˆ é™¤è¿™æ¡è®°å½•ï¼Ÿ')) {
            const p = projects.find(p => p.id === pid);
            if(p) {
                p.logs = p.logs.filter(l => l.id !== logId);
                saveAndRender();
            }
        }
    }

    function addLogEntry(project, seconds, type, dateStr = null, tag = '') {
        project.logs.push({
            id: Date.now(),
            dateStr: dateStr || new Date().toISOString().split('T')[0],
            durationSeconds: seconds,
            workTag: tag,
            type: type
        });
    }

    function toggleArchive(id, status) {
        const p = projects.find(p => p.id === id);
        if(p.isRunning) stopTimer(id);
        p.status = status;
        saveAndRender();
    }

    function deleteProject(id) {
        if(confirm('ç¡®å®šåˆ é™¤è¯¥é¡¹ç›®ï¼Ÿæ— æ³•æ¢å¤ã€‚')) {
            projects = projects.filter(p => p.id !== id);
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem(DB_KEY, JSON.stringify(projects));
        renderProjects();
    }

    function hardReset() {
        if(confirm('âš ï¸ è¿™å°†æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ç¡®å®šè¦é‡ç½®å—ï¼Ÿ')) {
            localStorage.removeItem(DB_KEY);
            location.reload();
        }
    }

    // --- å®šæ—¶å™¨ä¸UIå·¥å…· ---
    function startGlobalTicker() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            const activeProject = projects.find(p => p.isRunning);
            if (activeProject) {
                const totalLogged = activeProject.logs.reduce((sum, l) => sum + (l.durationSeconds||0), 0);
                const current = (Date.now() - activeProject.currentSessionStart)/1000;
                const el = document.getElementById(`timer-${activeProject.id}`);
                if (el) el.innerText = formatTimeHHMM(totalLogged + current);
            }
        }, 1000);
    }

    function formatTimeHHMM(s) {
        if (s < 0) s = 0;
        const h = Math.floor(s / 3600);
        const m = Math.floor((s % 3600) / 60);
        return `${h}:${m.toString().padStart(2, '0')}`;
    }

    // --- Modal é€»è¾‘ ---
    function openCreateModal() {
        document.getElementById('new-name').value = '';
        document.getElementById('new-project-tag').value = '';
        document.getElementById('new-budget-money').value = '';
        document.getElementById('new-budget-hours').value = '';
        document.getElementById('calc-rate').value = '...';
        openModal('create');
    }

    function openLogModal(id) {
        document.getElementById('log-project-id').value = id;
        document.getElementById('log-duration').value = '';
        document.getElementById('log-work-tag').value = '';
        document.getElementById('log-date').value = new Date().toISOString().split('T')[0];
        openModal('log');
    }

    function openModal(type) { document.getElementById(`modal-${type}`).style.display = 'flex'; }
    function closeModal(type) { document.getElementById(`modal-${type}`).style.display = 'none'; }

    function initModalListeners() {
        // è‡ªåŠ¨è®¡ç®—æ—¶è–ª
        const m = document.getElementById('new-budget-money');
        const h = document.getElementById('new-budget-hours');
        const r = document.getElementById('calc-rate');
        const update = () => {
            const valM = parseFloat(m.value) || 0;
            const valH = parseFloat(h.value) || 0;
            r.value = (valM > 0 && valH > 0) ? (valM / valH).toFixed(1) : '...';
        };
        m.addEventListener('input', update);
        h.addEventListener('input', update);

        // ç‚¹å‡»é®ç½©å…³é—­
        window.onclick = function(e) {
            if (e.target.classList.contains('modal-overlay')) e.target.style.display = "none";
        }
    }
</script>
</body>
</html>